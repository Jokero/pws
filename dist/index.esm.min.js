function index(e,n,o,t){if("function"==typeof n&&(o=n,n=void 0),Array.isArray(n)||"object"!=typeof n||(t=n,n=void 0),"object"==typeof o&&(t=o,o=void 0),o||"undefined"!=typeof window&&(o=window.WebSocket,"undefined"!=typeof window&&"function"==typeof window.addEventListener&&window.addEventListener("online",p)),!o)throw new Error("Please supply a websocket library to use");t||(t={});var r=null,i=!1,a=null,u=null,c=null,l=!1,s={open:[],close:[],error:[],message:[]},f={CONNECTING:"CONNECTING"in o?o.CONNECTING:0,OPEN:"OPEN"in o?o.OPEN:1,CLOSING:"CLOSING"in o?o.CLOSING:2,CLOSED:"CLOSED"in o?o.CLOSED:3,get readyState(){return r.readyState},get protocol(){return r.protocol},get extensions(){return r.extensions},get bufferedAmount(){return r.bufferedAmount},get binaryType(){return r.binaryType},set binaryType(e){c=e,r.binaryType=e},connect:p,url:e,retries:0,pingTimeout:"pingTimeout"in t&&t.pingTimeout,maxTimeout:t.maxTimeout||3e5,maxRetries:t.maxRetries||0,nextReconnectDelay:t.nextReconnectDelay||function(e){return Math.min((1+Math.random())*Math.pow(1.5,e)*1e3,f.maxTimeout)},send:function(){r.send.apply(r,arguments)},close:function(){clearTimeout(a),l=!0,r.close.apply(r,arguments)},onopen:t.onopen,onmessage:t.onmessage,onclose:t.onclose,onerror:t.onerror};return f.addEventListener=f.on=function(e,n){s[e].push(n),r&&(r.on||r.addEventListener).call(r,e,n)},f.removeEventListener=f.off=function(e,n){s[e].splice(s[e].indexOf(n),1),r&&(r.off||r.removeEventListener).call(r,e,n)},f.once=function(e,n){f.addEventListener(e,function o(t){f.removeEventListener(e,o),n(t)})},e&&p(),f;function p(e){l=!1,clearTimeout(a),"string"==typeof e&&(f.url=e),r&&g(r),i=!1,r=new o("function"==typeof f.url?f.url(f):f.url,n,t),Object.keys(s).forEach(function(e){s[e].forEach(function(n){return(r.on||r.addEventListener).call(r,e,n)})}),c&&(r.binaryType=c),r.onclose=d,r.onerror=m,r.onopen=y,r.onmessage=E}function d(e){f.onclose&&f.onerror.apply(f,arguments),r.onclose=null,l||(e.reconnectDelay=Math.ceil(T()))}function m(e){f.onerror&&f.onerror.apply(f,arguments),e||(e=new Error("UnknownError")),e.reconnectDelay=Math.ceil(T())}function y(e){f.onopen&&f.onopen.apply(f,arguments),w(),f.retries=0}function E(e){f.onmessage&&f.onmessage.apply(f,arguments),w()}function w(){f.pingTimeout&&(clearTimeout(u),u=setTimeout(v,f.pingTimeout))}function v(){var e="No heartbeat received in due time",n="undefined"!=typeof window&&window.CloseEvent?new window.CloseEvent("HeartbeatTimeout",{wasClean:!0,code:4663,reason:e}):new Error("HeartbeatTimeout");n.code=4663,n.reason=e,d(n),r.close(n.code,n.reason)}function T(){if(i)return Date.now()-i;if(r&&g(r),i=Date.now(),f.retries++,!(f.maxRetries&&f.retries>=f.maxRetries)){var e=f.nextReconnectDelay(f.retries);return a=setTimeout(p,e),e}}function g(e){e.onclose=null,e.onopen=null,e.onerror=null,e.onmessage=null,Object.keys(s).forEach(function(n){s[n].forEach(function(o){return(e.off||e.removeEventListener).call(e,n,o)})}),e.close()}}export default index;
